<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cablemaster Configuratore (MVP)</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="assets/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar__title">
      <h1>Cablemaster Configuratore</h1>
      <p class="sub">Glendinning-first • BOM esportabile • Offline (PWA)</p>
    </div>
    <div class="topbar__actions">
      <button id="btnInstall" class="btn btn-secondary" hidden>Installa</button>
      <button id="btnReset" class="btn btn-secondary">Reset</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>Dati base</h2>

      <form id="baseForm" class="grid">
        <label>
          Fornitore principale
          <select id="brand" disabled>
            <option>Glendinning</option>
          </select>
        </label>

        <label>
          Regione
          <select id="region">
            <option value="EU" selected>EU</option>
            <option value="USA">USA</option>
          </select>
        </label>

        <label>
          Corrente (A)
          <input id="amps" type="number" min="1" step="1" value="125" required />
        </label>

        <label>
          Frequenza (Hz)
          <select id="hz">
            <option value="50" selected>50</option>
            <option value="60">60</option>
          </select>
        </label>

        <label>
          Fasi
          <select id="phase">
            <option value="1PH">Monofase (1PH)</option>
            <option value="3PH" selected>Trifase (3PH)</option>
          </select>
        </label>

        <label>
          Tipologia spina (pin)
          <select id="pins">
            <option value="3">3 pin</option>
            <option value="4">4 pin</option>
            <option value="5" selected>5 pin</option>
          </select>
        </label>

        <label>
          Alimentazione motore (V DC)
          <select id="motor_voltage_vdc">
            <option value="12">12</option>
            <option value="24" selected>24</option>
          </select>
        </label>

        <div class="row-span-2">
          <fieldset class="fieldset">
            <legend>Opzioni</legend>
            <label class="checkbox">
              <input id="need_hawse_pipe" type="checkbox" checked />
              <span>Serve hawse pipe/passascafo (barriera stagna e alloggio spina)</span>
            </label>
            <label class="checkbox">
              <input id="allow_fallback" type="checkbox" />
              <span>Accetta equivalenti non-Glendinning se manca un codice (fallback)</span>
            </label>
          </fieldset>
        </div>

        <div class="row-span-2">
          <fieldset class="fieldset">
            <legend>Routing (installazione)</legend>
            <label>
              Modalità
              <select id="routing_mode">
                <option value="direct" selected>Diretto (nessun PVC)</option>
                <option value="pvc_straight">PVC dritto</option>
                <option value="pvc_with_bends">PVC con curve</option>
                <option value="remote_mount_overhead">Montaggio remoto (overhead)</option>
              </select>
            </label>

            <label class="checkbox">
              <input id="has_bend_over_45" type="checkbox" />
              <span>Curve &gt; 45° (solo se PVC con curve)</span>
            </label>

            <label>
              Lunghezza cavo (m)
              <select id="cable_length_m">
                <option value="20" selected>20</option>
                <option value="30">30</option>
              </select>
            </label>
          </fieldset>
        </div>

        <div class="row-span-2">
          <fieldset class="fieldset">
            <legend>Connettori (se disponibili)</legend>
            <p class="hint">Se il configuratore non trova codici Glendinning per la spina/presa richieste, verranno inserite righe “da definire”. Se abiliti fallback, potrai inserire manualmente un equivalente.</p>
            <label>
              Spina maschio (SKU)
              <input id="connector_male" placeholder="(auto) oppure inserisci manualmente" />
            </label>
            <label>
              Presa femmina (SKU)
              <input id="connector_female" placeholder="(auto) oppure inserisci manualmente" />
            </label>
            <label>
              Cover/ghiera (SKU) (opzionale)
              <input id="cover" placeholder="(auto) oppure inserisci manualmente" />
            </label>
          </fieldset>
        </div>

        <div class="actions row-span-1">
          <button id="btnGenerate" class="btn" type="submit">Genera BOM</button>
          <button id="btnExportCsv" class="btn btn-secondary" type="button" disabled>Esporta CSV</button>
          <button id="btnCopy" class="btn btn-secondary" type="button" disabled>Copia BOM</button>
        </div>
      </form>

      <div id="status" class="status" role="status" aria-live="polite"></div>
    </section>

    <section class="card">
      <div class="card__head">
        <h2>BOM</h2>
        <div class="muted" id="bomMeta"></div>
      </div>

      <div class="table-wrap">
        <table id="bomTable">
          <thead>
            <tr>
              <th>SKU</th>
              <th>Descrizione</th>
              <th>Q.tà</th>
              <th>Note</th>
              <th>Fonte</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="5" class="muted">Compila i dati e premi “Genera BOM”.</td></tr>
          </tbody>
        </table>
      </div>

      <details class="notes">
        <summary>Note e controlli</summary>
        <ul id="notesList"></ul>
      </details>
    </section>

    <footer class="footer">
      <p class="muted">
        MVP per GitHub Pages. Dati: <code>data/catalog.glendinning.core.json</code> e <code>data/rules.glendinning.v0.json</code>.
      </p>
    </footer>
  </main>

  <script src="app.js"></script>
</body>
</html>
