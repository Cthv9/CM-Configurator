<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cablemaster Configuratore</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="assets/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="topbar">
  <div>
    <h1>Cablemaster Configuratore</h1>
    <p class="sub">Wizard filtrato (Glendinning primario) • Dati da <code>cablemaster_master.json</code></p>
  </div>
  <div class="topbar__actions">
    <button id="btnInstall" class="btn btn-secondary" hidden>Installa</button>
    <button id="btnReset" class="btn btn-secondary">Reset</button>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="stepper">
      <button class="step active" data-step="1">1. Base</button>
      <button class="step" data-step="2">2. Cavo</button>
      <button class="step" data-step="3">3. Spina/Presa</button>
      <button class="step" data-step="4">4. Hawse pipe</button>
      <button class="step" data-step="5">5. Container</button>
      <button class="step" data-step="6">6. BOM</button>
    </div>

    <div id="status" class="status" role="status" aria-live="polite"></div>

    <section class="pane active" data-pane="1">
      <h2>Base (motore)</h2>
      <p class="hint">Seleziona la famiglia (CRMA / CM4 / CM7 / CM8 / CM9) e la tensione motore. Lo SKU viene scelto automaticamente e mostrato sotto.</p>
      <div class="filters">
        <label>Motore (V DC)
          <select id="motorV">
            <option value="12">12</option>
            <option value="24" selected>24</option>
          </select>
        </label>
      </div>
      <div id="baseList" class="picklist"></div>
      <div class="actions">
        <button class="btn" id="to2" disabled>Avanti</button>
      </div>
    </section>

    <section class="pane" data-pane="2">
      <h2>Cavo</h2>
      <p class="hint">Mostriamo solo i cavi compatibili con la base scelta (limiti di ampere). Filtri: ricerca, ampere, lunghezza.</p>
      <div class="filters">
        <label>Ricerca <input id="cableSearch" placeholder="es. 63A 4x16 20m" /></label>
        <label>Ampere
          <select id="cableAmps">
            <option value="">Qualsiasi</option>
          </select>
        </label>
        <label>Lunghezza (m)
          <select id="cableLen">
            <option value="">Qualsiasi</option>
          </select>
        </label>
      </div>
      <div id="cableList" class="picklist"></div>
      <div class="actions">
        <button class="btn btn-secondary" data-prev="1">Indietro</button>
        <button class="btn" id="to3" disabled>Avanti</button>
      </div>
    </section>

    <section class="pane" data-pane="3">
      <h2>Spina e Presa</h2>
      <p class="hint">Filtrate sul cavo scelto: amperaggio deve combaciare; poli coerenti quando deducibili dal numero conduttori. La presa è opzionale.</p>
      <div class="split">
        <div>
          <h3>Spina (maschio)</h3>
          <input id="maleSearch" placeholder="cerca spina" />
          <div id="maleList" class="picklist"></div>
        </div>
        <div>
          <h3>Presa (femmina) (opzionale)</h3>
          <input id="femaleSearch" placeholder="cerca presa" />
          <div id="femaleList" class="picklist"></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn btn-secondary" data-prev="2">Indietro</button>
        <button class="btn" id="to4" disabled>Avanti</button>
      </div>
    </section>

    <section class="pane" data-pane="4">
      <h2>Hawse pipe</h2>
      <p class="hint">Scelte prese solo dalla whitelist per famiglia (niente guarnizioni/ricambi). Se non troviamo nulla, lo segnaliamo.</p>
      <div id="hpList" class="picklist"></div>
      <div class="actions">
        <button class="btn btn-secondary" data-prev="3">Indietro</button>
        <button class="btn" id="to5" disabled>Avanti</button>
      </div>
    </section>

    <section class="pane" data-pane="5">
      <h2>Container</h2>
      <p class="hint">Scelte prese solo dalla whitelist per famiglia. Se non troviamo nulla, lo segnaliamo.</p>
      <div id="containerList" class="picklist"></div>
      <div class="actions">
        <button class="btn btn-secondary" data-prev="4">Indietro</button>
        <button class="btn" id="to6" disabled>Vai a BOM</button>
      </div>
    </section>

    <section class="pane" data-pane="6">
      <h2>BOM</h2>
      <div class="actions">
        <button id="btnExportCsv" class="btn btn-secondary" disabled>Esporta CSV</button>
      </div>
      <div class="table-wrap">
        <table id="bomTable">
          <thead><tr><th>Ruolo</th><th>SKU</th><th>Descrizione</th><th>Q.tà</th><th>Fonte</th></tr></thead>
          <tbody><tr><td colspan="5" class="muted">Completa i passi.</td></tr></tbody>
        </table>
      </div>
      <details class="notes">
        <summary>Decisioni</summary>
        <ul id="trace"></ul>
      </details>
      <div class="actions">
        <button class="btn btn-secondary" data-prev="5">Indietro</button>
      </div>
    </section>
  </section>

  <footer class="footer">
    <p class="muted">Nota: catalogo filtrato solo codici <code>_001</code> (nuovo). Tutto ciò che non è in categorie “wizard” resta fuori (misc).</p>
  </footer>
</main>

<script src="app.js"></script>
</body>
</html>
